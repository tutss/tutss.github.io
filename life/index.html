<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life calendar</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            font-size: 15px;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        .controls {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }
        input[type="number"], input[type="text"], input[type="color"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .activity-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        .activity-inputs {
            display: grid;
            grid-template-columns: 1fr 80px 40px 32px;
            gap: 8px;
            align-items: end;
        }
        @media (max-width: 480px) {
            .activity-inputs {
                grid-template-columns: 1fr 60px 36px 32px;
                gap: 4px;
            }
        }
        button {
            padding: 10px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        .btn-remove {
            background: #dc3545;
            padding: 8px;
            width: 32px;
            height: 32px;
            font-size: 18px;
            line-height: 1;
        }
        .btn-remove:hover {
            background: #c82333;
        }
        .btn-add {
            width: 100%;
            margin-top: 10px;
        }
        canvas {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }
        .stats {
            margin-top: 15px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 14px;
        }
        .stats strong {
            color: #1976d2;
        }
        #tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <h1>Life calendar in months</h1>
    <p class="subtitle">Visualize your remaining time by activity. Hover over circles (or tap on mobile) to see details. Customize activities and hours in the panel to see how you'll spend your time.</p>

    <div id="tooltip" style="display: none;"></div>

    <div class="container">
        <div class="controls">
            <div class="input-group">
                <label>Current Age (years)</label>
                <input type="number" id="age" value="18" min="0" max="120">
            </div>
            
            <div class="input-group">
                <label>Life Expectancy (years)</label>
                <input type="number" id="lifeExpectancy" value="90" min="0" max="120">
            </div>
            
            <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
            
            <h3 style="margin-top: 0;">Activities (hours/day)</h3>
            <div id="activities"></div>
            <button class="btn-add" onclick="addActivity()">+ Add</button>
            
            <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
            
            <button onclick="generateChart()" style="width: 100%; padding: 12px; font-size: 16px;">
                Generate
            </button>
            
            <div class="stats" id="stats"></div>
        </div>
        
        <div>
            <canvas id="lifeCanvas"></canvas>
        </div>
    </div>

    <script>
        const defaultActivities = [
            { name: 'Sleep', hours: 8, color: '#9B8DB5' },
            { name: 'Work', hours: 8, color: '#A8C5A0' },
            { name: 'Eating', hours: 2, color: '#D89BA8' },
            { name: 'Hygiene', hours: 1, color: '#85B5D4' }
        ];

        let circleData = [];

        function initActivities() {
            const container = document.getElementById('activities');
            container.innerHTML = '';
            defaultActivities.forEach((act, idx) => {
                addActivityItem(act.name, act.hours, act.color, idx);
            });
        }

        function addActivity() {
            const container = document.getElementById('activities');
            const idx = container.children.length;
            addActivityItem('New Activity', 1, '#' + Math.floor(Math.random()*16777215).toString(16), idx);
        }

        function addActivityItem(name, hours, color, idx) {
            const container = document.getElementById('activities');
            const div = document.createElement('div');
            div.className = 'activity-item';
            div.innerHTML = `
                <div class="activity-inputs">
                    <input type="text" value="${name}" placeholder="Activity name" id="act-name-${idx}">
                    <input type="number" value="${hours}" min="0" max="24" step="0.5" id="act-hours-${idx}">
                    <input type="color" value="${color}" id="act-color-${idx}">
                    <button class="btn-remove" onclick="this.parentElement.parentElement.remove()">Ã—</button>
                </div>
            `;
            container.appendChild(div);
        }

        function getActivities() {
            const container = document.getElementById('activities');
            const activities = [];
            Array.from(container.children).forEach((item, idx) => {
                const name = document.getElementById(`act-name-${idx}`)?.value || '';
                const hours = parseFloat(document.getElementById(`act-hours-${idx}`)?.value || 0);
                const color = document.getElementById(`act-color-${idx}`)?.value || '#000000';
                if (name && hours > 0) {
                    activities.push({ name, hours, color });
                }
            });
            return activities;
        }

        function generateChart() {
            const age = parseInt(document.getElementById('age').value);
            const lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value);
            const activities = getActivities();
            
            const remainingYears = lifeExpectancy - age;
            const totalMonths = remainingYears * 12;
            
            const processedActivities = activities.map(act => ({
                name: act.name,
                months: (act.hours / 24) * totalMonths,
                color: act.color
            }));
            
            const totalAllocated = processedActivities.reduce((sum, act) => sum + act.months, 0);
            const freeMonths = totalMonths - totalAllocated;
            
            drawChart(age, lifeExpectancy, totalMonths, processedActivities, freeMonths);
            updateStats(totalMonths, processedActivities, freeMonths);
        }

        function drawChart(age, lifeExpectancy, totalMonths, activities, freeMonths) {
            const canvas = document.getElementById('lifeCanvas');
            const ctx = canvas.getContext('2d');

            const isMobile = window.innerWidth <= 768;
            const isSmallMobile = window.innerWidth <= 480;

            let cols = 36;
            let circleRadius = 12;
            let spacing = 28;
            let headerHeight = 120;
            let titleFontSize = 18;
            let subtitleFontSize = 12;

            if (isSmallMobile) {
                cols = 12;
                circleRadius = 8;
                spacing = 20;
                headerHeight = 100;
                titleFontSize = 14;
                subtitleFontSize = 10;
            } else if (isMobile) {
                cols = 18;
                circleRadius = 10;
                spacing = 24;
                headerHeight = 110;
                titleFontSize = 16;
                subtitleFontSize = 11;
            }

            const rows = Math.ceil(totalMonths / cols);

            canvas.width = cols * spacing + 40;
            canvas.height = rows * spacing + headerHeight;

            circleData = [];
            circleData.radius = circleRadius;

            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#333';
            ctx.font = `bold ${titleFontSize}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.fillText(`An ${age} year old's remaining time in months`, canvas.width / 2, 25);

            ctx.font = `italic ${subtitleFontSize}px sans-serif`;
            ctx.fillStyle = '#666';
            ctx.fillText(`(Assuming ${lifeExpectancy} year life expectancy)`, canvas.width / 2, 45);
            const yearsPerRow = (cols / 12).toFixed(1);
            ctx.fillText(`1 row = ${cols} months = ${yearsPerRow} years`, canvas.width / 2, 65);
            
            const activityCumsum = [0];
            activities.forEach(act => {
                activityCumsum.push(activityCumsum[activityCumsum.length - 1] + Math.floor(act.months));
            });
            
            let monthCounter = 0;
            const topMargin = headerHeight - 20;
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const x = col * spacing + 20;
                    const y = row * spacing + topMargin;

                    let color = 'white';
                    let strokeColor = '#D0D0D0';
                    let currentActivity = null;

                    if (monthCounter < totalMonths) {
                        for (let i = 0; i < activities.length; i++) {
                            if (monthCounter >= activityCumsum[i] && monthCounter < activityCumsum[i + 1]) {
                                color = activities[i].color;
                                strokeColor = activities[i].color;
                                currentActivity = activities[i];
                                break;
                            }
                        }
                    }

                    ctx.beginPath();
                    ctx.arc(x, y, circleRadius, 0, 2 * Math.PI);
                    ctx.fillStyle = color;
                    ctx.fill();
                    ctx.strokeStyle = strokeColor;
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    circleData.push({
                        x: x,
                        y: y,
                        activity: currentActivity
                    });

                    monthCounter++;
                }
            }
        }

        function updateStats(totalMonths, activities, freeMonths) {
            const statsDiv = document.getElementById('stats');
            let html = `<strong>Total months:</strong> ${totalMonths}<br><br>`;

            activities.forEach(act => {
                html += `<strong>${act.name}:</strong> ${Math.floor(act.months)} months (${(act.months / 12).toFixed(1)} years)<br>`;
            });

            html += `<br><strong>Free time:</strong> ${Math.floor(freeMonths)} months (${(freeMonths / 12).toFixed(1)} years)`;
            statsDiv.innerHTML = html;
        }

        function getCircleAtPosition(mouseX, mouseY) {
            const canvas = document.getElementById('lifeCanvas');
            const rect = canvas.getBoundingClientRect();

            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const x = (mouseX - rect.left) * scaleX;
            const y = (mouseY - rect.top) * scaleY;

            for (let i = 0; i < circleData.length; i++) {
                const circle = circleData[i];
                const distance = Math.sqrt((x - circle.x) ** 2 + (y - circle.y) ** 2);
                if (distance <= circleData.radius) {
                    return circle.activity;
                }
            }
            return null;
        }

        function showTooltip(activity, mouseX, mouseY) {
            if (!activity) return;

            const tooltip = document.getElementById('tooltip');
            const months = Math.floor(activity.months);
            const years = (activity.months / 12).toFixed(1);
            tooltip.innerHTML = `${activity.name}: ${months} months (${years} years)`;
            tooltip.style.display = 'block';
            tooltip.style.left = (mouseX + 15) + 'px';
            tooltip.style.top = (mouseY + 15) + 'px';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        }

        initActivities();
        generateChart();

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                generateChart();
            }, 250);
        });

        const canvas = document.getElementById('lifeCanvas');

        canvas.addEventListener('mousemove', (e) => {
            const activity = getCircleAtPosition(e.clientX, e.clientY);
            if (activity) {
                showTooltip(activity, e.clientX, e.clientY);
                canvas.style.cursor = 'pointer';
            } else {
                hideTooltip();
                canvas.style.cursor = 'default';
            }
        });

        canvas.addEventListener('mouseout', () => {
            hideTooltip();
            canvas.style.cursor = 'default';
        });

        canvas.addEventListener('click', (e) => {
            const activity = getCircleAtPosition(e.clientX, e.clientY);
            if (activity) {
                showTooltip(activity, e.clientX, e.clientY);
            } else {
                hideTooltip();
            }
        });
    </script>
</body>
</html>